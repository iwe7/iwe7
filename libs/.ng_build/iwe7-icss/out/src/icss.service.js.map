{"version":3,"file":"icss.service.js","sourceRoot":"","sources":["icss.service.ts"],"names":[],"mappings":"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","sourcesContent":["import { Injectable, ElementRef } from '@angular/core';\nimport { Subject, Observable, of, MonoTypeOperatorFunction, merge } from 'rxjs';\nimport { map, scan, throttle, throttleTime, first } from 'rxjs/operators';\nexport interface IcssInterface {\n  [key: string]: Observable<any>;\n}\n@Injectable({\n  providedIn: 'root'\n})\nexport class IcssService {\n  state: any = {};\n  constructor() {}\n  init(ob: IcssInterface, ele?: ElementRef) {\n    const obs: Observable<{ [key: string]: any }>[] = [];\n    for (const key in ob) {\n      const newOb = ob[key].pipe(\n        map(res => {\n          return {\n            [`${key}`]: res\n          };\n        })\n      );\n      obs.push(newOb);\n    }\n    // 合并流\n    const mer = merge(...obs).pipe(\n      scan((state, style) => {\n        return { ...state, ...style };\n      }, {}),\n      map(style => {\n        this.styledash(ele.nativeElement).set(style);\n        return style;\n      })\n    );\n    mer.pipe(first()).subscribe(res => {\n      this.state = res;\n    });\n    mer.subscribe(res => {});\n    return mer;\n  }\n\n  getState(key?: string) {\n    if (!!key) {\n      return this.state[key] || {};\n    }\n    return this.state;\n  }\n\n  private parse(val: any) {\n    return typeof val === 'boolean' ? (!!val ? 1 : 0) : val;\n  }\n\n  private styledash(target: HTMLElement) {\n    return {\n      set: (key, val?) => {\n        if (typeof key === 'object' && val === undefined) {\n          return Object.keys(key).forEach(subKey =>\n            this.styledash(target).set(subKey, key[subKey])\n          );\n        }\n        if (typeof val === 'object') {\n          return Object.keys(val).forEach(subkey => {\n            this.styledash(target).set(`${key}-${subkey}`, val[subkey]);\n          });\n        }\n        return target.style.setProperty(`--${key}`, this.parse(val) as string);\n      },\n      get: key => target.style.getPropertyValue(`--${key}`)\n    };\n  }\n\n  vendorPrefix() {\n    if (typeof window === 'undefined' || typeof document === 'undefined')\n      return '';\n    const styles = window.getComputedStyle(document.documentElement, '') || [\n      '-moz-hidden-iframe'\n    ];\n    const pre = (Array.prototype.slice\n      .call(styles)\n      .join('')\n      .match(/-(moz|webkit|ms)-/) ||\n      ((<any>styles).OLink === '' && ['', 'o']))[1];\n    switch (pre) {\n      case 'ms':\n        return 'ms';\n      default:\n        return pre && pre.length ? pre[0].toUpperCase() + pre.substr(1) : '';\n    }\n  }\n}\n"]}